<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{{ url_for('static', filename='img/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout/base.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    {% block customCSS %}
    {% endblock %}
    <title>{% block title %}Empijamadas{% endblock %}</title>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">
                    <img id="logo-img" src="{{ url_for('static', filename='img/logo.png') }}" alt="">
                </div>
                <span style="font-size: 20px; font-weight: bold;">
                    Empijamadas
                </span>
            </div>
            <div id="search-container" class="search-container" aria-hidden="true" style="display: none;">
                <form id="search-form" class="search-form" role="search" onsubmit="return false;">
                    <input id="search-input" class="search-input" type="search" placeholder="Buscar..." aria-label="Buscar">
                    <button id="search-close" type="button" class="search-close btn btn-link">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </form>
            </div>
            <nav>
                <a href="/">Home</a>
                <a href="/tienda">Tienda</a>
                <a href="/tienda/mujer">Mujer</a>
                <a href="/tienda/hombres">Hombres</a>
                <a href="/tienda/gorros">Gorros</a>
                <a href="/nosotros">Sobre nosotros</a>
                <a href="/contacto">Contact Us</a>
                
                <!-- Links visibles solo para roles específicos -->
                {% if is_admin %}
                    <a href="/admin/dashboard" style="color: #ff6b6b;">
                        <i class="bi bi-shield-check"></i> Admin
                    </a>
                {% endif %}
                
                {% if has_any_role('bodeguero', 'administrador') %}
                    <a href="/bodega/inventario">
                        <i class="bi bi-box-seam"></i> Bodega
                    </a>
                {% endif %}
                
                {% if has_any_role('vendedor', 'administrador') %}
                    <a href="/ventas/dashboard">
                        <i class="bi bi-graph-up"></i> Ventas
                    </a>
                {% endif %}
            </nav>
            <div class="header-icons">
                <a href="#" class="icon-placeholder" id="search-toggle" aria-label="Buscar">
                    <i class="bi bi-search"></i>
                </a>

                <a href="/carrito" class="icon-placeholder" id="cart-icon" aria-label="Carrito">
                    <i class="bi bi-cart-fill"></i>
                </a>

                {% if is_authenticated %}
                    <!-- Usuario autenticado: mostrar menú dropdown -->
                    <div class="user-menu">
                        <a href="#" class="icon-placeholder" id="user-icon" aria-label="Mi cuenta">
                            <i class="bi bi-person-circle"></i>
                        </a>
                        <div class="user-dropdown" id="user-dropdown">
                            <div class="user-dropdown-header">
                                <p>{{ current_user.nombre if current_user.nombre else 'Usuario' }}</p>
                                <small>{{ current_user.email }}</small>
                                
                                <!-- Mostrar roles del usuario -->
                                {% if current_user.roles %}
                                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #eee;">
                                        {% for rol in current_user.roles %}
                                            <span style="display: inline-block; background: #e3f2fd; color: #1976d2; padding: 2px 8px; border-radius: 12px; font-size: 11px; margin: 2px;">
                                                {{ rol }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <a href="/cuenta">
                                <i class="bi bi-person"></i>
                                Mi Cuenta
                            </a>
                            <a href="/carrito">
                                <i class="bi bi-cart"></i>
                                Mi Carrito
                            </a>
                            
                            <!-- Links específicos por rol -->
                            {% if is_admin %}
                                <a href="/admin/dashboard">
                                    <i class="bi bi-speedometer2"></i>
                                    Panel Admin
                                </a>
                                <a href="/admin/usuarios">
                                    <i class="bi bi-people"></i>
                                    Gestión Usuarios
                                </a>
                                <a href="/admin/roles">
                                    <i class="bi bi-shield-lock"></i>
                                    Gestión Roles
                                </a>
                            {% endif %}
                            
                            {% if is_bodeguero %}
                                <a href="/bodega/inventario">
                                    <i class="bi bi-box-seam"></i>
                                    Inventario
                                </a>
                            {% endif %}
                            
                            {% if is_vendedor %}
                                <a href="/ventas/dashboard">
                                    <i class="bi bi-graph-up"></i>
                                    Mis Ventas
                                </a>
                            {% endif %}
                            
                            <a href="{{ url_for('main.logout') }}" class="logout-link">
                                <i class="bi bi-box-arrow-right"></i>
                                Cerrar Sesión
                            </a>
                        </div>
                    </div>
                {% else %}
                    <!-- Usuario NO autenticado: link a login -->
                    <a href="{{ url_for('main.login') }}" class="icon-placeholder" id="user-icon" aria-label="Iniciar sesión">
                        <i class="bi bi-person-circle"></i>
                    </a>
                {% endif %}
            </div>
        </div>
    </header>
    
    {% block content %}
    {% endblock %}
    <script src="{{ url_for('static', filename='js/search-toggle.js')}}"></script>
    {% block customJS %}
    {% endblock %}
</body>
</html>